{"ast":null,"code":"import React from 'react';\nimport { useFocusManager } from '@react-aria/focus';\nimport { useId } from '@react-native-aria/utils';\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport { ResponsiveQueryContext } from \"../../../utils/useResponsiveQuery/ResponsiveQueryProvider\";\nimport { uniqueId } from 'lodash';\nexport var useMenuTrigger = function useMenuTrigger(_ref) {\n  var handleOpen = _ref.handleOpen,\n    isOpen = _ref.isOpen;\n  var menuTriggerId = uniqueId();\n\n  var responsiveQueryContext = React.useContext(ResponsiveQueryContext);\n  var disableCSSMediaQueries = responsiveQueryContext.disableCSSMediaQueries;\n  if (!disableCSSMediaQueries) {\n    menuTriggerId = useId();\n  }\n  return {\n    'onKeyDownCapture': function onKeyDownCapture(event) {\n      if ([' ', 'Enter', 'ArrowUp', 'ArrowDown'].includes(event.key)) {\n        event.preventDefault();\n        handleOpen();\n      }\n    },\n    'aria-haspopup': 'menu',\n    'aria-expanded': isOpen ? true : undefined,\n    'nativeID': menuTriggerId\n  };\n};\nexport var useMenu = function useMenu() {\n  var focusManager = useFocusManager();\n  var onKeyDown = function onKeyDown(e) {\n    switch (e.key) {\n      case 'ArrowDown':\n        {\n          e.preventDefault();\n          focusManager.focusNext({\n            wrap: true\n          });\n          break;\n        }\n      case 'ArrowUp':\n        {\n          e.preventDefault();\n          focusManager.focusPrevious({\n            wrap: true\n          });\n          break;\n        }\n    }\n  };\n  return {\n    onKeyDown: onKeyDown,\n    accessibilityRole: 'menu'\n  };\n};\nexport var useMenuItem = function useMenuItem(_ref2) {\n  var textValue = _ref2.textValue,\n    ref = _ref2.ref;\n  return {\n    accessibilityRole: 'menuitem',\n    dataSet: {\n      nativebaseMenuItem: textValue\n    },\n    onHoverIn: function onHoverIn() {\n      if (ref.current && Platform.OS === 'web') ref.current.focus();\n    }\n  };\n};\nexport var useMenuOptionItem = function useMenuOptionItem(_ref3) {\n  var isChecked = _ref3.isChecked,\n    type = _ref3.type;\n  return {\n    accessibilityRole: 'menuitem' + (Platform.OS === 'web' ? type : ''),\n    accessibilityState: {\n      checked: isChecked\n    },\n    accessibilityChecked: isChecked\n  };\n};\nvar ITEM_ATTR = 'data-nativebase-menu-item';\nvar getValue = function getValue(element) {\n  var _element$getAttribute;\n  return (_element$getAttribute = element.getAttribute(ITEM_ATTR)) !== null && _element$getAttribute !== void 0 ? _element$getAttribute : '';\n};\nexport var useMenuTypeahead = function useMenuTypeahead(props) {\n  return {\n    onKeyDown: function onKeyDown(event) {\n      if (props.onKeyDown) {\n        props.onKeyDown(event);\n      }\n      if (event.key.length === 1 && !(event.ctrlKey || event.altKey || event.metaKey)) {\n        var container = event.currentTarget;\n        var values = Array.from(container.querySelectorAll(\"[\".concat(ITEM_ATTR, \"]\"))).map(getValue);\n        var searchKey = event.key;\n        var foundValue = values.find(function (value) {\n          return value.toLowerCase().startsWith(searchKey);\n        });\n        var newItem = container.querySelector(\"[\".concat(ITEM_ATTR, \"=\\\"\").concat(foundValue, \"\\\"]\"));\n        if (newItem) {\n          setTimeout(function () {\n            return newItem.focus();\n          });\n        }\n      }\n    }\n  };\n};","map":{"version":3,"sources":["useMenu.tsx"],"names":["React","useFocusManager","useId","ResponsiveQueryContext","uniqueId","useMenuTrigger","handleOpen","isOpen","menuTriggerId","responsiveQueryContext","useContext","disableCSSMediaQueries","event","includes","key","preventDefault","undefined","useMenu","focusManager","onKeyDown","e","focusNext","wrap","focusPrevious","accessibilityRole","useMenuItem","textValue","ref","dataSet","nativebaseMenuItem","onHoverIn","current","Platform","OS","focus","useMenuOptionItem","isChecked","type","accessibilityState","checked","accessibilityChecked","ITEM_ATTR","getValue","element","getAttribute","useMenuTypeahead","props","length","ctrlKey","altKey","metaKey","container","currentTarget","values","Array","from","querySelectorAll","map","searchKey","foundValue","find","value","toLowerCase","startsWith","newItem","querySelector","setTimeout"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,eAAT,QAAgC,mBAAhC;AACA,SAASC,KAAT,QAAsB,0BAAtB;AAAA;AAEA,SAASC,sBAAT;AACA,SAASC,QAAT,QAAyB,QAAzB;AAOA,OAAO,IAAMC,cAAc,GAAG,SAAjBA,cAAc,OAAkD;EAAA,IAA5CC,UAAF,QAAEA,UAAF;IAAcC,MAAAA,QAAAA,MAAAA;EAC3C,IAAIC,aAAa,GAAGJ,QAAQ,EAD+C;;EAI3E,IAAMK,sBAAsB,GAAGT,KAAK,CAACU,UAANV,CAAiBG,sBAAjBH,CAA/B;EACA,IAAMW,sBAAsB,GAAGF,sBAAsB,CAACE,sBAAtD;EAEA,IAAI,CAACA,sBAAL,EAA6B;IAI3BH,aAAa,GAAGN,KAAK,EAArBM;EACD;EACD,OAAO;IACL,kBAAA,EAAqBI,0BAAAA,KAAD,EAA0B;MAC5C,IAAI,CAAC,GAAD,EAAM,OAAN,EAAe,SAAf,EAA0B,WAA1B,CAAA,CAAuCC,QAAvC,CAAgDD,KAAK,CAACE,GAAtD,CAAJ,EAAgE;QAC9DF,KAAK,CAACG,cAANH,EAAAA;QACAN,UAAU,EAAA;MACX;IACF,CANI;IAOL,eAAA,EAAiB,MAPZ;IAQL,eAAA,EAAiBC,MAAM,GAAG,IAAH,GAAUS,SAR5B;IASL,UAAA,EAAYR;EATP,CAAP;AAWD,CAxBM;AA0BP,OAAO,IAAMS,OAAO,GAAG,SAAVA,OAAO,GAAS;EAC3B,IAAMC,YAAY,GAAGjB,eAAe,EAApC;EACA,IAAMkB,SAAS,GAAIC,SAAbD,SAAS,CAAIC,CAAD,EAAsB;IACtC,QAAQA,CAAC,CAACN,GAAV;MACE,KAAK,WAAL;QAAkB;UAChBM,CAAC,CAACL,cAAFK,EAAAA;UACAF,YAAY,CAACG,SAAbH,CAAuB;YAAEI,IAAI,EAAE;UAAR,CAAvBJ,CAAAA;UACA;QACD;MACD,KAAK,SAAL;QAAgB;UACdE,CAAC,CAACL,cAAFK,EAAAA;UACAF,YAAY,CAACK,aAAbL,CAA2B;YAAEI,IAAI,EAAE;UAAR,CAA3BJ,CAAAA;UACA;QACD;IAAA;EAEJ,CAbD;EAeA,OAAO;IACLC,SADK,EACLA,SADK;IAELK,iBAAiB,EAAE;EAFd,CAAP;AAID,CArBM;AAuBP,OAAO,IAAMC,WAAW,GAAG,SAAdA,WAAW,QAMlB;EAAA,IALJC,SAD0B,SAC1BA,SAD0B;IAE1BC,GAAAA,SAAAA,GAAAA;EAKA,OAAO;IACLH,iBAAiB,EAAE,UADd;IAELI,OAAO,EAAE;MACPC,kBAAkB,EAAEH;IADb,CAFJ;IAKLI,SAAS,EAAE,qBAAM;MACf,IAAIH,GAAG,CAACI,OAAJJ,IAAeK,QAAQ,CAACC,EAATD,KAAgB,KAAnC,EAA0CL,GAAG,CAACI,OAAJJ,CAAYO,KAAZP,EAAAA;IAC3C;EAPI,CAAP;AASD,CAhBM;AAkBP,OAAO,IAAMQ,iBAAiB,GAAG,SAApBA,iBAAiB,QAMxB;EAAA,IALJC,SADgC,SAChCA,SADgC;IAEhCC,IAAAA,SAAAA,IAAAA;EAKA,OAAO;IACLb,iBAAiB,EAAG,UAAA,IACjBQ,QAAQ,CAACC,EAATD,KAAgB,KAAhBA,GAAwBK,IAAxBL,GAA+B,EADd,CADf;IAGLM,kBAAkB,EAAE;MAClBC,OAAO,EAAEH;IADS,CAHf;IAMLI,oBAAoB,EAAEJ;EANjB,CAAP;AAQD,CAfM;AAiBP,IAAMK,SAAS,GAAG,2BAAlB;AACA,IAAMC,QAAQ,GAAIC,SAAZD,QAAQ,CAAIC,OAAD,EAAA;EAAA,IAAA,qBAAA;EAAA,OAAA,CAAA,qBAAA,GAAsBA,OAAO,CAACC,YAARD,CAAqBF,SAArBE,CAAtB,MAAA,IAAA,IAAA,qBAAA,KAAA,KAAA,CAAA,GAAA,qBAAA,GAAyD,EAAzD;AAAA,CAAjB;AAEA,OAAO,IAAME,gBAAgB,GAAIC,SAApBD,gBAAgB,CAAIC,KAAD,EAAqB;EACnD,OAAO;IACL3B,SAAS,qBAACP,KAAD,EAAuB;MAC9B,IAAIkC,KAAK,CAAC3B,SAAV,EAAqB;QACnB2B,KAAK,CAAC3B,SAAN2B,CAAgBlC,KAAhBkC,CAAAA;MACD;MAED,IACElC,KAAK,CAACE,GAANF,CAAUmC,MAAVnC,KAAqB,CAArBA,IACA,EAAEA,KAAK,CAACoC,OAANpC,IAAiBA,KAAK,CAACqC,MAAvBrC,IAAiCA,KAAK,CAACsC,OAAzC,CAFF,EAGE;QACA,IAAMC,SAAS,GAAGvC,KAAK,CAACwC,aAAxB;QACA,IAAMC,MAAM,GAAGC,KAAK,CAACC,IAAND,CACbH,SAAS,CAACK,gBAAVL,CAAAA,GAAAA,CAAAA,MAAAA,CAA+BV,SAA/BU,EAAAA,GAAAA,CAAAA,CADaG,CAAAA,CAEbG,GAFaH,CAETZ,QAFSY,CAAf;QAIA,IAAMI,SAAS,GAAG9C,KAAK,CAACE,GAAxB;QAEA,IAAM6C,UAAU,GAAGN,MAAM,CAACO,IAAPP,CAAaQ,UAAAA,KAAD;UAAA,OAC7BA,KAAK,CAACC,WAAND,EAAAA,CAAoBE,UAApBF,CAA+BH,SAA/BG,CADiBR;QAAAA,EAAnB;QAGA,IAAMW,OAAO,GAAGb,SAAS,CAACc,aAAVd,CAAAA,GAAAA,CAAAA,MAAAA,CACVV,SADUU,EAAAA,KAAAA,CAAAA,CAAAA,MAAAA,CACIQ,UADJR,EAAAA,KAAAA,CAAAA,CAAhB;QAIA,IAAIa,OAAJ,EAAa;UAKXE,UAAU,CAAC;YAAA,OAAOF,OAAD,CAAyB9B,KAAzB,EAAP;UAAA,EAAVgC;QACD;MACF;IACF;EAhCI,CAAP;AAkCD,CAnCM","sourcesContent":["import React from 'react';\nimport { useFocusManager } from '@react-aria/focus';\nimport { useId } from '@react-native-aria/utils';\nimport { AccessibilityRole, Platform } from 'react-native';\nimport { ResponsiveQueryContext } from '../../../utils/useResponsiveQuery/ResponsiveQueryProvider';\nimport { uniqueId } from 'lodash';\n\ntype IMenuTriggerProps = {\n  handleOpen: () => void;\n  isOpen: boolean;\n};\n\nexport const useMenuTrigger = ({ handleOpen, isOpen }: IMenuTriggerProps) => {\n  let menuTriggerId = uniqueId();\n\n  // let id = uniqueId();\n  const responsiveQueryContext = React.useContext(ResponsiveQueryContext);\n  const disableCSSMediaQueries = responsiveQueryContext.disableCSSMediaQueries;\n\n  if (!disableCSSMediaQueries) {\n    // This if statement technically breaks the rules of hooks, but is safe\n    // because the condition never changes after mounting.\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    menuTriggerId = useId();\n  }\n  return {\n    'onKeyDownCapture': (event: KeyboardEvent) => {\n      if ([' ', 'Enter', 'ArrowUp', 'ArrowDown'].includes(event.key)) {\n        event.preventDefault();\n        handleOpen();\n      }\n    },\n    'aria-haspopup': 'menu',\n    'aria-expanded': isOpen ? true : undefined,\n    'nativeID': menuTriggerId,\n  };\n};\n\nexport const useMenu = () => {\n  const focusManager = useFocusManager();\n  const onKeyDown = (e: KeyboardEvent) => {\n    switch (e.key) {\n      case 'ArrowDown': {\n        e.preventDefault();\n        focusManager.focusNext({ wrap: true });\n        break;\n      }\n      case 'ArrowUp': {\n        e.preventDefault();\n        focusManager.focusPrevious({ wrap: true });\n        break;\n      }\n    }\n  };\n\n  return {\n    onKeyDown,\n    accessibilityRole: 'menu' as AccessibilityRole,\n  };\n};\n\nexport const useMenuItem = ({\n  textValue,\n  ref,\n}: {\n  textValue: string;\n  ref: any;\n}) => {\n  return {\n    accessibilityRole: 'menuitem' as AccessibilityRole,\n    dataSet: {\n      nativebaseMenuItem: textValue,\n    },\n    onHoverIn: () => {\n      if (ref.current && Platform.OS === 'web') ref.current.focus();\n    },\n  };\n};\n\nexport const useMenuOptionItem = ({\n  isChecked,\n  type,\n}: {\n  isChecked: boolean;\n  type: 'checkbox' | 'radio';\n}) => {\n  return {\n    accessibilityRole: ('menuitem' +\n      (Platform.OS === 'web' ? type : '')) as AccessibilityRole,\n    accessibilityState: {\n      checked: isChecked,\n    },\n    accessibilityChecked: isChecked,\n  };\n};\n\nconst ITEM_ATTR = 'data-nativebase-menu-item';\nconst getValue = (element: Element) => element.getAttribute(ITEM_ATTR) ?? '';\n\nexport const useMenuTypeahead = (props: any): any => {\n  return {\n    onKeyDown(event: KeyboardEvent) {\n      if (props.onKeyDown) {\n        props.onKeyDown(event);\n      }\n\n      if (\n        event.key.length === 1 &&\n        !(event.ctrlKey || event.altKey || event.metaKey)\n      ) {\n        const container = event.currentTarget as HTMLElement;\n        const values = Array.from(\n          container.querySelectorAll(`[${ITEM_ATTR}]`)\n        ).map(getValue);\n\n        const searchKey = event.key;\n\n        const foundValue = values.find((value) =>\n          value.toLowerCase().startsWith(searchKey)\n        );\n        const newItem = container.querySelector(\n          `[${ITEM_ATTR}=\"${foundValue}\"]`\n        );\n\n        if (newItem) {\n          /**\n           * Imperative focus during keydown is risky so we prevent React's batching updates\n           * to avoid potential bugs. See: https://github.com/facebook/react/issues/20332\n           */\n          setTimeout(() => (newItem as HTMLElement).focus());\n        }\n      }\n    },\n  };\n};\n"]},"metadata":{},"sourceType":"module"}